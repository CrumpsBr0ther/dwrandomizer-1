
#include <math.h>
#include <stdio.h>
#include <stddef.h>
#include <inttypes.h>
#include "dwr_types.h"
#include "polyfit.h"

const polyfactors mon_hp_fac = { /* monster HP */
    3,
    255,
    -3.736289884089558,
    5.422688356299423,
    -0.8389673452460288,
    0.07236387774917684,
    -0.002601235415781611,
    3.318835134891174e-05,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_str_fac = { /* monster strength */
    5,
    255,
    -6.669620803842882,
    11.986588276842362,
    -2.2661671142685984,
    0.1818510420657916,
    -0.005869674265773839,
    6.615713537705403e-05,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_agi_fac = { /* monster agility */
    3,
    255,
    -7.696329251267564,
    11.412803592343945,
    -2.0953013078667917,
    0.17068501484807957,
    -0.005712660511493273,
    6.723981544176638e-05,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};


const polyfactors mon_xp_fac = { /* xp drop */
    1,
    255,
    0.1021343775438055,
    0.49473462717265304,
    0.13414863527908247,
    0.032298648707288075,
    -0.009037240980161442,
    0.0008932851448447719,
    -4.1231873788179154e-05,
    8.990615445684386e-07,
    -7.447159111606538e-09,
    0.0,
    0.0,
};

const polyfactors mon_gold_fac = { /* gold drop */
    1,
    255,
    -5.412228497998058,
    8.512778468387427,
    -1.7312632721229664,
    0.1560551738655128,
    -0.005098998914876418,
    5.638482680403456e-05,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};


const polyfactors mon_sr_fac = { /* sleep resist */
    0,
    15,
    -0.19522634033269348,
    0.0027062049290357856,
    0.01237738626799184,
    0.02735078913927832,
    -0.011130163381360846,
    0.0016886032484722438,
    -0.0001306290733001985,
    5.6891545792548995e-06,
    -1.4121558220430732e-07,
    1.8653624253963177e-09,
    -1.0180705237172738e-11,
};

const polyfactors mon_ssr_fac = { /* stopspell resist */
    0,
    15,
    -0.08458180321190412,
    0.5401797217575453,
    -0.2797847184732541,
    0.05207538905308297,
    -0.00453500220327152,
    0.0001987153225581766,
    -4.203801383039288e-06,
    3.410121385272191e-08,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_hr_fac = { /* hurt resist */
    0,
    15,
    0.4314693776787841,
    -1.5664045346083948,
    0.8529833853114857,
    -0.1771048400236765,
    0.01799585004910412,
    -0.0009845403089581877,
    2.947647208577527e-05,
    -4.5291082376858194e-07,
    2.7867550489446558e-09,
    0.0,
    0.0,
};

const polyfactors mon_dodge_fac = { /* dodge rate */
    0,
    15,
    0.16715459693038692,
    0.004994660125692795,
    0.022882989522377564,
    0.050852468833527203,
    -0.01899139628432672,
    0.00276423745596809,
    -0.00021099621897919147,
    9.218496364238239e-06,
    -2.32101949653519e-07,
    3.1346608250456317e-09,
    -1.7591815157369517e-11,
};

const polyfactors hero_hp_fac = { /* hero hp */
    10,
    255,
    1.3020102651284304,
    14.65859306842743,
    -2.448520773237392,
    0.22930567988184355,
    -0.008096230600909592,
    8.542092765129183e-05,
    3.6274818526749186e-07,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors hero_mp_fac = { /* hero mp */
    0,
    255,
    -3.7561276597920426,
    7.501346811101766,
    -1.323632281248492,
    0.2303665064506826,
    -0.013865062060044012,
    0.00034409645211497253,
    -2.990279519998751e-06,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors hero_str_fac = { /* hero mp */
    4,
    255,
    1.4686745240173096,
    4.1980629859970495,
    -1.0123001197185382,
    0.23914913301688095,
    -0.018515617930351082,
    0.0005946495857744039,
    -6.8558741039836946e-06,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors hero_agi_fac = { /* hero agility */
    4,
    255,
    0.2830854909068421,
    5.107788643989031,
    -1.901280557235743,
    0.39818305076478794,
    -0.02920077495522549,
    0.000899199586351207,
    -9.963014726110941e-06,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors hero_xp_fac = { /* random level xp */
    1,
    65535,
    -203.9930248427263,
    355.710547735673,
    -123.22889565409092,
    13.309885476933784,
    -0.23922916799801897,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors wpn_price_fac = { /* weapon prices */
    5,
    65535,
    3.514576883197151,
    -131.34297021780944,
    104.16571157815333,
    -20.19142289169297,
    1.2180107366833113,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

double polyfit(double x, const polyfactors *fac)
{
    size_t i;
    double result = 0.0;
    const double *factors = &fac->x0;

    for (i = 0; i <= 10; i++) {
        if (factors[i]) {
            result += factors[i] * pow(x, (double)i);
        }
    }
    result = MAX(result, fac->y_min);
    result = MIN(result, fac->y_max);
    return roundl(result);
}

