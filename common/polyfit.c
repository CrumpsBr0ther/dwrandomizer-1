
#include <math.h>
#include <stdio.h>
#include <stddef.h>
#include <inttypes.h>
#include "dwr_types.h"
#include "polyfit.h"

const polyfactors mon_hp_fac = { /* monster HP */
    3,
    255,
    -3.736289884089558,
    5.422688356299423,
    -0.8389673452460288,
    0.07236387774917684,
    -0.002601235415781611,
    3.318835134891174e-05,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_str_fac = { /* monster strength */
    5,
    255,
    -6.669620803842882,
    11.986588276842362,
    -2.2661671142685984,
    0.1818510420657916,
    -0.005869674265773839,
    6.615713537705403e-05,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_agi_fac = { /* monster agility */
    3,
    255,
    -7.696329251267564,
    11.412803592343945,
    -2.0953013078667917,
    0.17068501484807957,
    -0.005712660511493273,
    6.723981544176638e-05,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};


const polyfactors mon_xp_fac = { /* xp drop */
    1,
    255,
    7.489683634294877,
    -7.279169478981365,
    1.7500607154875778,
    -0.12142950130593827,
    0.003583934358624863,
    -3.561435209409325e-05,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_gold_fac = { /* gold drop */
    1,
    255,
    -5.412228497998058,
    8.512778468387427,
    -1.7312632721229664,
    0.1560551738655128,
    -0.005098998914876418,
    5.638482680403456e-05,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};


const polyfactors mon_sr_fac = { /* sleep resist */
    0,
    15,
    -0.19522634033269348,
    0.0027062049290357856,
    0.01237738626799184,
    0.02735078913927832,
    -0.011130163381360846,
    0.0016886032484722438,
    -0.0001306290733001985,
    5.6891545792548995e-06,
    -1.4121558220430732e-07,
    1.8653624253963177e-09,
    -1.0180705237172738e-11,
};

const polyfactors mon_ssr_fac = { /* stopspell resist */
    0,
    15,
    -0.08458180321190412,
    0.5401797217575453,
    -0.2797847184732541,
    0.05207538905308297,
    -0.00453500220327152,
    0.0001987153225581766,
    -4.203801383039288e-06,
    3.410121385272191e-08,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_hr_fac = { /* hurt resist */
    0,
    15,
    -0.08458495453567139,
    1.080357966170694,
    -1.1191380291302022,
    0.41660292597585985,
    -0.07256001316061905,
    0.006358888878417766,
    -0.0002690432402606899,
    4.364954745650351e-06,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_dodge_fac = { /* dodge rate */
    0,
    15,
    0.16715459693038692,
    0.004994660125692795,
    0.022882989522377564,
    0.050852468833527203,
    -0.01899139628432672,
    0.00276423745596809,
    -0.00021099621897919147,
    9.218496364238239e-06,
    -2.32101949653519e-07,
    3.1346608250456317e-09,
    -1.7591815157369517e-11,
};

const polyfactors hero_hp_fac = { /* hero hp */
    1,
    255,
    0.14995073809140536,
    20.000631022613483,
    -4.688305767690631,
    0.5692562817968293,
    -0.03017754000164617,
    0.0007235294119074531,
    -6.441357669473291e-06,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors hero_mp_fac = { /* hero mp */
    0,
    255,
    -2.9059955604139276,
    8.975689376161853,
    -1.790833514736787,
    0.2710007106629034,
    -0.015464829655700923,
    0.00037181327468471803,
    -3.1494750949434547e-06,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors hero_str_fac = { /* hero mp */
    4,
    255,
    1.4686745240173096,
    4.1980629859970495,
    -1.0123001197185382,
    0.23914913301688095,
    -0.018515617930351082,
    0.0005946495857744039,
    -6.8558741039836946e-06,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors hero_agi_fac = { /* hero agility */
    4,
    255,
    0.7795765715872776,
    6.218010548570424,
    -2.073069638254477,
    0.39204417266622144,
    -0.02773653858034715,
    0.0008385030434632235,
    -9.186781579906267e-06,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors hero_xp_fac = { /* random level xp */
    1,
    65535,
    -176.75277277932764,
    126.36983588254563,
    -1.2485787394955248,
    -7.476416837754428,
    1.2756718310884887,
    -0.04934888838682294,
    0.0005911469106933964,
    0.0,
    0.0,
    0.0,
    0.0,
};

double polyfit(double x, const polyfactors *fac)
{
    size_t i;
    double result = 0.0;
    const double *factors = &fac->x0;

    for (i = 0; i <= 10; i++) {
        if (factors[i]) {
            result += factors[i] * pow(x, (double)i);
        }
    }
    result = MAX(result, fac->y_min);
    result = MIN(result, fac->y_max);
    return roundl(result);
}

