
#include <math.h>
#include <stdio.h>
#include <stddef.h>
#include <inttypes.h>
#include "dwr_types.h"
#include "polyfit.h"

const polyfactors mon_hp_fac = { /* monster HP */
    3,
    255,
    -9.963841777001374,
    8.454464882934817,
    -1.3030567173494914,
    0.10287367249259728,
    -0.0035005800831845774,
    4.2935341320271974e-05,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_str_fac = { /* monster strength */
    5,
    255,
    -17.122064777331587,
    16.827828360192285,
    -2.967672859575701,
    0.225529906099072,
    -0.00709399951981401,
    7.884633642164365e-05,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_agi_fac = { /* monster agility */
    3,
    255,
    -18.781392931397956,
    16.16038494431541,
    -2.7182226936743086,
    0.20523737020030292,
    -0.0065653285676726975,
    7.495944393279058e-05,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};


const polyfactors mon_xp_fac = { /* xp drop */
    1,
    65535,
    -20.841100680021054,
    26.84734630013967,
    -9.825840742202868,
    1.6959832502784307,
    -0.15254999072108652,
    0.0076971508758765135,
    -0.00021823995314218197,
    3.2334332823059712e-06,
    -1.9381476733584117e-08,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_gold_fac = { /* gold drop */
    1,
    65535,
    -153.00793271673868,
    284.2718724719048,
    -181.74947413497537,
    57.014098325897635,
    -10.150090517124674,
    1.113262515544717,
    -0.07862090539258011,
    0.0036396408970707566,
    -0.00010971845872177492,
    2.0729070162690267e-06,
    -2.2275110183191443e-08,
    1.0383640532609873e-10,
    0.0,
    0.0,
};


const polyfactors mon_sr_fac = { /* sleep resist */
    0,
    15,
    -2.1969437076317404,
    3.483961128823471,
    -1.8204222230467941,
    0.4520755754949881,
    -0.06254050232250673,
    0.0052010391351393,
    -0.0002681807562045997,
    8.596519147477848e-06,
    -1.6601627035508357e-07,
    1.7617581896745132e-09,
    -7.862108379050638e-12,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_ssr_fac = { /* stopspell resist */
    0,
    15,
    -1.3975554576022768,
    1.1092073308967485,
    -0.34011588034318774,
    0.05251897032361768,
    -0.003980681424706965,
    0.00015503321304148872,
    -2.9829159588564997e-06,
    2.24678806115065e-08,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_hr_fac = { /* hurt resist */
    0,
    15,
    3.239518498565487,
    -4.208288329186024,
    1.671124663419926,
    -0.29681665124095485,
    0.027534617270887022,
    -0.0014224210043402236,
    4.1036011631450263e-05,
    -6.158661983444021e-07,
    3.73676230182728e-09,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_dodge_fac = { /* dodge rate */
    0,
    15,
    0.5368685340509266,
    -1.19322450637194,
    1.135749874694354,
    -0.3569654344660422,
    0.0558650996237906,
    -0.005026490880983962,
    0.0002775653042091582,
    -9.586780557000136e-06,
    2.022816058385553e-07,
    -2.3870467816279395e-09,
    1.2078878215282233e-11,
    0.0,
    0.0,
    0.0,
};

const polyfactors hero_hp_fac = { /* hero hp */
    10,
    254,
    10.769305218816912,
    10.38282954566378,
    -2.1766062394137147,
    0.291310320096156,
    -0.014950948297038679,
    0.0003205574441787177,
    -2.327262068436651e-06,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors hero_mp_fac = { /* hero mp */
    0,
    254,
    -3.7270868502803163,
    6.676421416658261,
    -1.1006456990549265,
    0.19759337455552484,
    -0.01152029068749358,
    0.000267979469132941,
    -2.085468610967839e-06,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors hero_str_fac = { /* hero str */
    4,
    255,
    2.5317219064841225,
    5.420847459516875,
    -0.3793744751677438,
    0.10014869410933366,
    -0.008497255220331646,
    0.0002843288176665623,
    -3.30935201379537e-06,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors hero_agi_fac = { /* hero agility */
    4,
    255,
    3.148947489377686,
    6.41515966116918,
    -1.0661437835489849,
    0.19987630931904798,
    -0.014402685932145512,
    0.00043713260565562723,
    -4.745739151708051e-06,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};


const polyfactors hero_xp_fac = { /* random level xp */
    1,
    65535,
    -203.9930248427263,
    355.710547735673,
    -123.22889565409092,
    13.309885476933784,
    -0.23922916799801897,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors wpn_price_fac = { /* weapon prices */
    5,
    65535,
    18.145188145239064,
    -142.37844514164718,
    106.63369825909453,
    -20.403062136809016,
    1.2241551018641001,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

/**
 * Solves a polynomial function for the given x value.
 *
 * @param x The x value
 * @param fac The factors for the polynomial
 *
 * @return The solution to the equation
 */
double polyfit(double x, const polyfactors *fac)
{
    size_t i;
    double result = 0.0;
    const double *factors = &fac->x0;

    for (i = 0; i <= 13; i++) {
        if (factors[i]) {
            result += factors[i] * pow(x, (double)i);
        }
    }
    result = MAX(result, fac->y_min);
    result = MIN(result, fac->y_max);
    return roundl(result);
}

