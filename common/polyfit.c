
#include <math.h>
#include <stdio.h>
#include <stddef.h>
#include <inttypes.h>
#include "dwr_types.h"
#include "polyfit.h"

const polyfactors mon_hp_fac = { /* monster HP */
    3,
    255,
    -9.963841777001374,
    8.454464882934817,
    -1.3030567173494914,
    0.10287367249259728,
    -0.0035005800831845774,
    4.2935341320271974e-05,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_str_fac = { /* monster strength */
    5,
    255,
    -17.122064777331587,
    16.827828360192285,
    -2.967672859575701,
    0.225529906099072,
    -0.00709399951981401,
    7.884633642164365e-05,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_agi_fac = { /* monster agility */
    3,
    255,
    -18.781392931397956,
    16.16038494431541,
    -2.7182226936743086,
    0.20523737020030292,
    -0.0065653285676726975,
    7.495944393279058e-05,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};


const polyfactors mon_xp_fac = { /* xp drop */
    1,
    65535,
    -20.841100680021054,
    26.84734630013967,
    -9.825840742202868,
    1.6959832502784307,
    -0.15254999072108652,
    0.0076971508758765135,
    -0.00021823995314218197,
    3.2334332823059712e-06,
    -1.9381476733584117e-08,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_gold_fac = { /* gold drop */
    1,
    65535,
    -181.6771668982451,
    386.8666504544928,
    -301.04838303113064,
    120.0121318216478,
    -28.239066882044998,
    4.255536278310077,
    -0.4310644096683368,
    0.030169784104046294,
    -0.0014761042847631243,
    5.032651290264322e-05,
    -1.170908028733686e-06,
    1.7713237145736675e-08,
    -1.5696278657423732e-10,
    6.179904820229751e-13,
};


const polyfactors mon_sr_fac = { /* sleep resist */
    0,
    15,
    -2.1969437076317404,
    3.483961128823471,
    -1.8204222230467941,
    0.4520755754949881,
    -0.06254050232250673,
    0.0052010391351393,
    -0.0002681807562045997,
    8.596519147477848e-06,
    -1.6601627035508357e-07,
    1.7617581896745132e-09,
    -7.862108379050638e-12,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_ssr_fac = { /* stopspell resist */
    0,
    15,
    -1.3975554576022768,
    1.1092073308967485,
    -0.34011588034318774,
    0.05251897032361768,
    -0.003980681424706965,
    0.00015503321304148872,
    -2.9829159588564997e-06,
    2.24678806115065e-08,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_hr_fac = { /* hurt resist */
    0,
    15,
    3.239518498565487,
    -4.208288329186024,
    1.671124663419926,
    -0.29681665124095485,
    0.027534617270887022,
    -0.0014224210043402236,
    4.1036011631450263e-05,
    -6.158661983444021e-07,
    3.73676230182728e-09,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors mon_dodge_fac = { /* dodge rate */
    0,
    15,
    0.5368685340509266,
    -1.19322450637194,
    1.135749874694354,
    -0.3569654344660422,
    0.0558650996237906,
    -0.005026490880983962,
    0.0002775653042091582,
    -9.586780557000136e-06,
    2.022816058385553e-07,
    -2.3870467816279395e-09,
    1.2078878215282233e-11,
    0.0,
    0.0,
    0.0,
};

const polyfactors hero_hp_fac = { /* hero hp */
    10,
    254,
    10.769305218816912,
    10.38282954566378,
    -2.1766062394137147,
    0.291310320096156,
    -0.014950948297038679,
    0.0003205574441787177,
    -2.327262068436651e-06,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors hero_mp_fac = { /* hero mp */
    0,
    254,
    0.13093148808975483,
    8.695665405039039,
    -22.78588836769728,
    19.084988390583433,
    -7.261082550213018,
    1.5887604731251848,
    -0.22145864502085602,
    0.020731125770043393,
    -0.001335795175925303,
    5.9460470002518895e-05,
    -1.797127696880616e-06,
    3.5208151060336736e-08,
    -4.032368075387321e-10,
    2.0490726714779504e-12,
};

const polyfactors hero_str_fac = { /* hero str */
    4,
    255,
    1.9855036334052616,
    0.34832358784053047,
    1.5428483226313243,
    0.3239461083788206,
    -0.21645012688898962,
    0.04302723862647274,
    -0.004579815435313073,
    0.00029461668659935543,
    -1.1834359468455204e-05,
    2.9112490218662203e-07,
    -4.019939224312338e-09,
    2.3890912704510155e-11,
    0.0,
    0.0,
};

const polyfactors hero_agi_fac = { /* hero agility */
    4,
    255,
    4.042393433680315,
    1.4391285141452397,
    3.872740592255078,
    -2.24526590826916,
    0.7134255669128887,
    -0.13361532225642578,
    0.015301508217809944,
    -0.001060052044776044,
    3.998825862775953e-05,
    -3.6196885559985426e-07,
    -3.514428765810476e-08,
    1.6259569090787755e-09,
    -2.9493035830245705e-11,
    2.0484508811893367e-13,
};


const polyfactors hero_xp_fac = { /* random level xp */
    1,
    65535,
    -203.9930248427263,
    355.710547735673,
    -123.22889565409092,
    13.309885476933784,
    -0.23922916799801897,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

const polyfactors wpn_price_fac = { /* weapon prices */
    5,
    65535,
    18.145188145239064,
    -142.37844514164718,
    106.63369825909453,
    -20.403062136809016,
    1.2241551018641001,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
};

/**
 * Solves a polynomial function for the given x value.
 *
 * @param x The x value
 * @param fac The factors for the polynomial
 *
 * @return The solution to the equation
 */
double polyfit(double x, const polyfactors *fac)
{
    size_t i;
    double result = 0.0;
    const double *factors = &fac->x0;

    for (i = 0; i <= 13; i++) {
        if (factors[i]) {
            result += factors[i] * pow(x, (double)i);
        }
    }
    result = MAX(result, fac->y_min);
    result = MIN(result, fac->y_max);
    return roundl(result);
}

